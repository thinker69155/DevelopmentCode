C51 COMPILER V7.08   WNL                                                                   04/09/2011 17:29:12 PAGE 1   


C51 COMPILER V7.08, COMPILATION OF MODULE WNL
OBJECT MODULE PLACED IN wnl.OBJ
COMPILER INVOKED BY: D:\Program Files\keil v2\C51\BIN\C51.EXE wnl.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          //Í·ÎÄ¼ş
   2          #include <REG52.h>
   3          #include <string.h>
   4          #include <intrins.h>
   5          
   6          #define uint  unsigned int
   7          #define uchar unsigned char
   8          /*****************************************************************************/
   9          
  10          //sbit LCM_cs   = P2^5;
  11          //sbit LCM_std  = P2^6;
  12          //sbit LCM_sclk = P2^7;
  13          //sbit LCM_psb  = P2^3;   //H=²¢¿Ú; L=´®¿Ú;
  14          //sbit LCM_rst  = P2^4;   //Reset Signal µÍµçÆ½ÓĞĞ§
  15          
  16          //============================1602===========================
  17          sbit en = P2^7;
  18          sbit rw = P2^6;
  19          sbit rs = P2^5;
  20          //data=P0;
  21          
  22          sbit beep  = P2^0;              //·äÃùÆ÷
  23          //***********************************************************
  24          //ÎÂ¶È´«¸ĞÆ÷¶¨Òå
  25          sbit DQ = P3^7;//ds18B20
  26          //************************************************************
  27          //¼üÅÌÒı½Å¶¨Òå
  28          sbit KEY_1 = P3^0;       //×óÉÏ
  29          sbit KEY_2 = P3^1;       //×óÏÂ
  30          sbit KEY_3 = P3^2;       //ÓÒÉÏ
  31          sbit KEY_4 = P3^3;       //ÓÒÏÂ  
  32          
  33          //¶¨ÒåDS1302Ê±ÖÓ½Ó¿Ú
  34          sbit  DS1302_CLK = P1^0;              //ÊµÊ±Ê±ÖÓÊ±ÖÓÏßÒı½Å 
  35          sbit  DS1302_IO  = P1^1;              //ÊµÊ±Ê±ÖÓÊı¾İÏßÒı½Å 
  36          sbit  DS1302_RST = P1^2;              //ÊµÊ±Ê±ÖÓ¸´Î»ÏßÒı½Å/***********************************************
             -******************************/
  37          
  38          //¶¨ÒåÀÛ¼ÓÆ÷AÖĞµÄ¸÷Î»
  39          sbit  ACC0 = ACC^0;
  40          sbit  ACC7 = ACC^7;
  41          /*****************************************************************************/
  42          //¶¨ÒåÈ«¾Ö±äÁ¿
  43          unsigned char yy,mo,dd,xq,hh,mm,ss,e;//¶¨ÒåÊ±¼äÓ³ÉäÈ«¾Ö±äÁ¿£¨×¨ÓÃ¼Ä´æÆ÷£©
  44          
  45          bit c_moon;
  46          data uchar year_moon,month_moon,day_moon,week;
  47          
  48          bit w = 0; //µ÷Ê±±êÖ¾Î»
  49          static unsigned char menu = 0;//¶¨Òå¾²Ì¬Ğ¡Ê±¸üĞÂÓÃÊı¾İ±äÁ¿
  50          static unsigned char keys = 0;//¶¨Òå¾²Ì¬Ğ¡Ê±¸üĞÂÓÃÊı¾İ±äÁ¿
  51          static unsigned char timecount = 0;//¶¨Òå¾²Ì¬Èí¼ş¼ÆÊıÆ÷±äÁ¿
  52          uchar code tab1[]={
  53          "  µç×ÓÍòÄêÀú    "
  54          "  °æ±¾£º V1.0   "
C51 COMPILER V7.08   WNL                                                                   04/09/2011 17:29:12 PAGE 2   

  55          "2008Äê11ÔÂ22ÈÕÒ¹"
  56          "      ÕÅÇ¿      "
  57          };
  58          /****************************************************************************/
  59          void DelayM(unsigned int a)       //ÑÓÊ±º¯Êı 1MS/´Î     
  60          {
  61   1                      unsigned char i;
  62   1                      while( --a != 0)
  63   1             {                
  64   2                              for(i = 0; i < 125; i++);  //Ò»¸ö ; ±íÊ¾¿ÕÓï¾ä,CPU¿Õ×ª¡£
  65   2                      }                                          //i ´Ó0¼Óµ½125£¬CPU´ó¸Å¾ÍºÄÊ±1ºÁÃë
  66   1      }
  67          
  68          /****************************************************************************/
  69          //º¯ÊıÉùÃ÷
  70          void LCM_WriteString(unsigned char *str) ;  //Ğ´×Ö·û  Àı£ºLCM_WriteString("ÄúºÃ£¡");
  71          void LCM_WriteDatOrCom(bit ,unsigned char );  //£¨0£¬Ö¸Áî£© £¨1£¬Êı¾İ£©
  72          void LCM_w_byte(unsigned char bbyte);  //Ğ´Ò»¸ö×Ö½Ú¸øLCM
  73          void delaynms(unsigned int di);  //ÑÓÊ±
  74          void LCM_init(void); //LCM³õÊ¼»¯
  75          void LCM_clr(void);  //ÇåÆÁ
  76          void Delay(int num);
  77          bit get_moon_day(uchar month_p,uint table_addr);
  78          void Conversion(bit c,uchar year,uchar month,uchar day);
  79          void nl();
  80          
  81          /*
  82          void days (viod)  //¹«Àú½ÚÈÕÊı¾İ¿â
  83          {        
  84                          
  85                          LCM_WriteDatOrCom(0,0x80);
  86          //              LCM_WriteString("[Dis]      [Set]");
  87          
  88                          LCM_WriteDatOrCom(0,0x98);
  89          //                                                                                              ----|----------------|
  90          
  91                          if ( mo == 0x01 && dd == 0x01 ){ LCM_WriteString("Happy New Year!!"); }//1ÔÂ
  92                          if ( mo == 0x01 && dd == 0x28 ){ LCM_WriteString("  ÊÀ½çÂé·çÈÕ    "); }
  93                          if (month_moon== 0x01 && day_moon == 0x01 ){  LCM_WriteString("    ½ñÈÕ´º½Ú    ");  }                   
             -                               
  94                          if (month_moon== 0x01 && day_moon == 0x15 ){ LCM_WriteString("  ÔªÏü½Ú¿ìÀÖ    "); }   
  95                                                                                                        
  96                    
  97                  if (month_moon== 0x02 && day_moon == 0x02 ){ LCM_WriteString("    ÇàÁú½Ú      "); }  
  98                          if ( mo == 0x02 && dd == 0x02 ){ LCM_WriteString("  ÊÀ½çÊªµØÈÕ    "); }//2ÔÂ
  99                          if ( mo == 0x02 && dd == 0x13 ){ LCM_WriteString("  Ã÷ÌìÇéÈË½ÚÁË  "); }         
 100                          if ( mo == 0x02 && dd == 0x14 ){ LCM_WriteString("  ½ñÌìÊÇÇéÈË½Ú  "); }
 101                                          
 102                          if ( mo == 0x03 && dd == 0x01 ){ LCM_WriteString("  ¹ú¼Êº£±ªÈÕ    "); }//3ÔÂ            
 103                          if ( mo == 0x03 && dd == 0x03 ){ LCM_WriteString("  È«¹ú°®¶úÈÕ    "); }         
 104                          if ( mo == 0x03 && dd == 0x08 ){ LCM_WriteString("   3.8¸¾Å®½Ú    "); }         
 105                          if ( mo == 0x03 && dd == 0x12 ){ LCM_WriteString("    Ö²Ê÷½Ú      "); }         
 106                          if ( mo == 0x03 && dd == 0x14 ){ LCM_WriteString("  ¹ú¼Ê¾¯²ìÈÕ    "); }         
 107                          if ( mo == 0x03 && dd == 0x15 ){ LCM_WriteString("  Ïû·ÑÕßÈ¨ÒæÈÕ  "); }         
 108                          if ( mo == 0x03 && dd == 0x17 ){ LCM_WriteString("  ¹ú¼Êº½º£ÈÕ    "); }         
 109                          if ( mo == 0x03 && dd == 0x21 ){ LCM_WriteString("  ÊÀ½çÉ­ÁÖÈÕ    "); }         
 110                          if ( mo == 0x03 && dd == 0x22 ){ LCM_WriteString("    ÊÀ½çË®ÈÕ    "); }         
 111                          if ( mo == 0x03 && dd == 0x23 ){ LCM_WriteString("  ÊÀ½çÆøÏóÈÕ    "); }         
 112                          if ( mo == 0x03 && dd == 0x24 ){ LCM_WriteString("ÊÀ½ç·ÀÖÎ½áºË²¡ÈÕ"); }
 113                                          
 114                          if ( mo == 0x04 && dd == 0x01 ){ LCM_WriteString("ÓŞÈË½Ú  Ğ¡ĞÄÉÏµ±"); }//4              
 115                          if ( mo == 0x04 && dd == 0x07 ){ LCM_WriteString("  ÊÀ½çÎÀÉúÈÕ    "); }         
C51 COMPILER V7.08   WNL                                                                   04/09/2011 17:29:12 PAGE 3   

 116                          if ( mo == 0x04 && dd == 0x08 ){ LCM_WriteString("    ¸´»î½Ú      "); }         
 117                          if ( mo == 0x04 && dd == 0x13 ){ LCM_WriteString("  ºÚÉ«ĞÇÆÚÎå    "); }
 118                          
 119                      if (month_moon== 0x05 && day_moon == 0x05 ){ LCM_WriteString("    ¶ËÎç½Ú      "); }                 
 120                          if ( mo == 0x05 && dd == 0x01 ){ LCM_WriteString("  ÀÍ¶¯½Ú  ·Å¼Ù  "); }//5              
 121                          if ( mo == 0x05 && dd == 0x04 ){ LCM_WriteString("    ÇàÄê½Ú      "); }         
 122                          if ( mo == 0x05 && dd == 0x08 ){ LCM_WriteString("  ÊÀ½çºìÊ®×ÖÈÕ  "); }         
 123                          if ( mo == 0x05 && dd == 0x12 ){ LCM_WriteString("  ¹ú¼Ê»¤Ê¿½Ú    "); }         
 124                          if ( mo == 0x05 && dd == 0x05 ){ LCM_WriteString("½üÈÕ×¢ÒâÄ¸Ç×½Ú  "); }         
 125                          if ( mo == 0x05 && dd == 0x15 ){ LCM_WriteString("  ¹ú¼Ê¼ÒÍ¥ÈÕ    "); }
 126                          if ( mo == 0x05 && dd == 0x31 ){ LCM_WriteString("  ÊÀ½çÎŞÑÌÈÕ    "); }         
 127                                          
 128                          if ( mo == 0x06 && dd == 0x01 ){ LCM_WriteString("  ¹ú¼Ê¶ùÍ¯½Ú    "); }//6
 129                          if ( mo == 0x06 && dd == 0x05 ){ LCM_WriteString("  ÊÀ½ç»·¾³ÈÕ    "); }         
 130                          if ( mo == 0x06 && dd == 0x26 ){ LCM_WriteString("  ¹ú¼Ê½û¶¾ÈÕ    "); }         
 131                          if ( mo == 0x06 && dd == 0x06 ){ LCM_WriteString("  È«¹ú°®ÑÛÈÕ    "); }         
 132                          if ( mo == 0x06 && dd == 0x13 ){ LCM_WriteString("½üÈÕ×¢Òâ¸¸Ç×½Ú  "); }
 133                          if ( mo == 0x06 && dd == 0x15 ){ LCM_WriteString("½üÈÕ×¢Òâ¸¸Ç×½Ú  "); }
 134                          
 135                  if (month_moon== 0x07 && day_moon == 0x07 ){ LCM_WriteString("ÆòÇÉ½ÚÖĞ¹úÇéÈË½Ú"); }  
 136                  if (month_moon== 0x07 && day_moon == 0x15 ){ LCM_WriteString("    ÖĞÔª½Ú      "); }             
 137                          if ( mo == 0x07 && dd == 0x01 ){ LCM_WriteString("Ïã¸Û»Ø¹é¼ÇÄîÈÕ  "); }//7
 138                          if ( mo == 0x07 && dd == 0x07 ){ LCM_WriteString("¿¹ÈÕÕ½Õù¼ÇÄîÈÕ  "); }
 139                          if ( mo == 0x07 && dd == 0x11 ){ LCM_WriteString("  ÊÀ½çÈË¿ÚÈÕ    "); }
 140          
 141                      if (month_moon== 0x08 && day_moon == 0x15 ){ LCM_WriteString("  ÖĞÇï½Ú¿ìÀÖ    "); }  
 142                          if ( mo == 0x08 && dd == 0x01 ){ LCM_WriteString("  °ËÒ»½¨¾ü½Ú    "); }//8
 143                          if ( mo == 0x08 && dd == 0x08 ){ LCM_WriteString("  ÖĞ¹úÄĞ×Ó½Ú    "); }
 144                          if ( mo == 0x08 && dd == 0x15 ){ LCM_WriteString("¿¹Õ½Ê¤Àû¼ÇÄîÈÕ  "); }
 145          
 146                  if (month_moon== 0x09 && day_moon == 0x09 ){ LCM_WriteString("  ½ñÈÕÖØÑô½Ú    "); }  
 147                          if ( mo == 0x09 && dd == 0x10 ){ LCM_WriteString("  ÖĞ¹ú½ÌÊ¦½Ú    "); }//9
 148                          if ( mo == 0x09 && dd == 0x18 ){ LCM_WriteString("¾Å¡¤Ò»°ËÊÂ±ä¼ÇÄî"); }
 149                          if ( mo == 0x09 && dd == 0x20 ){ LCM_WriteString("  ¹ú¼Ê°®ÑÀÈÕ    "); }
 150                          if ( mo == 0x09 && dd == 0x27 ){ LCM_WriteString("  ÊÀ½çÂÃÓÎÈÕ    "); }
 151          
 152                          if ( mo == 0x10 && dd == 0x01 ){ LCM_WriteString("  ÖĞ¹ú¹úÇì½Ú    "); }//10
 153                          if ( mo == 0x10 && dd == 0x04 ){ LCM_WriteString("  ÊÀ½ç¶¯ÎïÈÕ    "); }
 154                          if ( mo == 0x10 && dd == 0x24 ){ LCM_WriteString("    ÁªºÏ¹úÈÕ    "); }
 155                          if ( mo == 0x10 && dd == 0x12 ){ LCM_WriteString("Ã÷Ìì¹ú¼Ê½ÌÊ¦½Ú  "); }
 156                          if ( mo == 0x10 && dd == 0x13 ){ LCM_WriteString("  ¹ú¼Ê½ÌÊ¦½Ú    "); }
 157          
 158                          if ( mo == 0x11 && dd == 0x10 ){ LCM_WriteString("  ÊÀ½çÇàÄê½Ú    "); }//11
 159                          if ( mo == 0x11 && dd == 0x17 ){ LCM_WriteString("  ÊÀ½çÑ§Éú½Ú    "); }
 160          
 161                      if (month_moon== 0x12 && day_moon == 0x08 ){ LCM_WriteString("  ½ñÈÕÀ°°Ë½Ú    "); }  
 162                  if (month_moon== 0x12 && day_moon == 0x15 ){ LCM_WriteString("  ¹ıĞ¡Äê        "); }  
 163                  if (month_moon== 0x12 && day_moon == 0x29 ){ LCM_WriteString("  À°ÔÂ¶şÊ®¾Å    "); }  
 164                  if (month_moon== 0x12 && day_moon == 0x30 ){ LCM_WriteString("  ´óÄêÈıÊ®(^o^) "); }
 165                          if ( mo == 0x12 && dd == 0x01 ){ LCM_WriteString("  ÊÀ½ç°¬×Ì²¡ÈÕ  "); }//12
 166                          if ( mo == 0x12 && dd == 0x23 ){ LCM_WriteString("  Ã÷ÍíÆ½°²Ò¹    "); }
 167                          if ( mo == 0x12 && dd == 0x24 ){ LCM_WriteString("  ½ñÍíÆ½°²Ò¹    "); }
 168                          if ( mo == 0x12 && dd == 0x25 ){ LCM_WriteString("    Ê¥µ®¿ìÀÖ    "); }
 169                          if ( mo == 0x12 && dd == 0x31 ){ LCM_WriteString("    Ã÷ÈÕĞÂÄê    "); }
 170          
 171                          else{ 
 172                                  if ( hh >= 0x04 && hh <  0x06 ){ LCM_WriteString("¡ï¡ï__¡ø¡ø__Áè³¿"); }
 173                                  if ( hh >= 0x06 && hh <  0x08 ){ LCM_WriteString("¡î¡ğ__¡ø¡÷__Ôç³¿"); }
 174                                  if ( hh >= 0x08 && hh <  0x12 ){ LCM_WriteString("__¡ñ__¡ø¡ø__ÉÏÎç"); }
 175                                  if ( hh == 0x12)               { LCM_WriteString("____¡ø¡ñ¡ø__ÖĞÎç"); }
 176                                  if ( hh >= 0x13 && hh <  0x18 ){ LCM_WriteString("__¡ø¡ø__¡ñ__ÏÂÎç"); }
 177                                  if ( hh >= 0x18 && hh <  0x22 ){ LCM_WriteString("¡÷¡ø__¡ñ¡î__ÍíÉÏ"); }
C51 COMPILER V7.08   WNL                                                                   04/09/2011 17:29:12 PAGE 4   

 178                                  if ( hh >= 0x22 && hh <= 0x23 ){ LCM_WriteString("¡÷¡ø__¡ï¡î__Ò¹Àï"); }
 179                                  if ( hh >= 0x00 && hh <  0x04 ){ LCM_WriteString("__¡ï¡ø¡ø¡ï__ÉîÒ¹"); }
 180                                  }
 181          }
 182          */
 183          
 184          //ÑÓÊ±º¯Êı£¬ºóÃæ¾­³£µ÷ÓÃ
 185          void delay(uint xms)//ÑÓÊ±º¯Êı£¬ÓĞ²Îº¯Êı
 186          {
 187   1              uint x,y;
 188   1              for(x=xms;x>0;x--)
 189   1               for(y=110;y>0;y--);
 190   1      }
 191          
 192          
 193          /********Òº¾§Ğ´ÈëÖ¸Áîº¯ÊıÓëĞ´ÈëÊı¾İº¯Êı£¬ÒÔºó¿Éµ÷ÓÃ**************/
 194          
 195          write_1602com(uchar com)//****Òº¾§Ğ´ÈëÖ¸Áîº¯Êı****
 196          {
 197   1              rs=0;//Êı¾İ/Ö¸ÁîÑ¡ÔñÖÃÎªÖ¸Áî
 198   1              rw=0; //¶ÁĞ´Ñ¡ÔñÖÃÎªĞ´
 199   1              P0=com;//ËÍÈëÊı¾İ
 200   1              delay(1);
 201   1              en=1;//À­¸ßÊ¹ÄÜ¶Ë£¬ÎªÖÆÔìÓĞĞ§µÄÏÂ½µÑØ×ö×¼±¸
 202   1              delay(1);
 203   1              en=0;//enÓÉ¸ß±äµÍ£¬²úÉúÏÂ½µÑØ£¬Òº¾§Ö´ĞĞÃüÁî
 204   1      }
 205          
 206          
 207          write_1602dat(uchar dat)//***Òº¾§Ğ´ÈëÊı¾İº¯Êı****
 208          {
 209   1              rs=1;//Êı¾İ/Ö¸ÁîÑ¡ÔñÖÃÎªÊı¾İ
 210   1              rw=0; //¶ÁĞ´Ñ¡ÔñÖÃÎªĞ´
 211   1              P0=dat;//ËÍÈëÊı¾İ
 212   1              delay(1);
 213   1              en=1; //enÖÃ¸ßµçÆ½£¬ÎªÖÆÔìÏÂ½µÑØ×ö×¼±¸
 214   1              delay(1);
 215   1              en=0; //enÓÉ¸ß±äµÍ£¬²úÉúÏÂ½µÑØ£¬Òº¾§Ö´ĞĞÃüÁî
 216   1      }
 217          
 218          
 219          lcd_init()//***Òº¾§³õÊ¼»¯º¯Êı****
 220          {
 221   1              write_1602com(0x38);//ÉèÖÃÒº¾§¹¤×÷Ä£Ê½£¬ÒâË¼£º16*2ĞĞÏÔÊ¾£¬5*7µãÕó£¬8Î»Êı¾İ
 222   1              write_1602com(0x0c);//¿ªÏÔÊ¾²»ÏÔÊ¾¹â±ê
 223   1              write_1602com(0x06);//ÕûÆÁ²»ÒÆ¶¯£¬¹â±ê×Ô¶¯ÓÒÒÆ
 224   1              write_1602com(0x01);//ÇåÏÔÊ¾
 225   1      
 226   1              write_1602com(yh+1);//ÈÕÀúÏÔÊ¾¹Ì¶¨·ûºÅ´ÓµÚÒ»ĞĞµÚ1¸öÎ»ÖÃÖ®ºó¿ªÊ¼ÏÔÊ¾
*** ERROR C202 IN LINE 226 OF WNL.C: 'yh': undefined identifier
 227   1              for(a=0;a<14;a++)
*** ERROR C202 IN LINE 227 OF WNL.C: 'a': undefined identifier
 228   1              {
 229   2              write_1602dat(tab1[a]);//ÏòÒº¾§ÆÁĞ´ÈÕÀúÏÔÊ¾µÄ¹Ì¶¨·ûºÅ²¿·Ö
*** ERROR C202 IN LINE 229 OF WNL.C: 'a': undefined identifier
 230   2              //delay(3);
 231   2              }
 232   1              write_1602com(er+2);//Ê±¼äÏÔÊ¾¹Ì¶¨·ûºÅĞ´ÈëÎ»ÖÃ£¬´ÓµÚ2¸öÎ»ÖÃºó¿ªÊ¼ÏÔÊ¾
*** ERROR C202 IN LINE 232 OF WNL.C: 'er': undefined identifier
 233   1              for(a=0;a<8;a++)
*** ERROR C202 IN LINE 233 OF WNL.C: 'a': undefined identifier
 234   1              {
C51 COMPILER V7.08   WNL                                                                   04/09/2011 17:29:12 PAGE 5   

 235   2              write_1602dat(tab2[a]);//Ğ´ÏÔÊ¾Ê±¼ä¹Ì¶¨·ûºÅ£¬Á½¸öÃ°ºÅ
*** ERROR C202 IN LINE 235 OF WNL.C: 'a': undefined identifier
 236   2              //delay(3);
 237   2              }
 238   1      }
 239          
 240          
 241          /*********************************************************************************/
 242          void chn_disp (uchar code *chn)
 243          {
 244   1        uchar i,j;
 245   1        LCM_WriteDatOrCom  (0,0x30);
 246   1        LCM_WriteDatOrCom  (0,0x80);
 247   1        for (j=0;j<4;j++)
 248   1        {
 249   2          for (i=0;i<16;i++)
 250   2          LCM_WriteDatOrCom  (1,chn[j*16+i]);
 251   2        }
 252   1      }
 253          
 254          
 255                  
 256          /*****************************************************************************/
 257          //ÇåÆÁº¯Êı
 258          void LCM_clr(void)
 259          {
 260   1        LCM_WriteDatOrCom (0,0x30);
 261   1        LCM_WriteDatOrCom (0,0x01);
 262   1        Delay (180);
 263   1      
 264   1      }
 265          
 266          /*****************************************************************************/
 267          //ÏòLCM·¢ËÍÒ»¸ö×Ö·û´®,³¤¶È64×Ö·ûÖ®ÄÚ¡£
 268          //Ó¦ÓÃ£ºLCM_WriteString("ÄúºÃ£¡"); 
 269          void LCM_WriteString(unsigned char *str)
 270          {
 271   1                      while(*str != '\0')
 272   1             {
 273   2                              LCM_WriteDatOrCom(1,*str++);
 274   2              }
 275   1                      *str = 0;
 276   1      }
 277          /******************************************************************************/
 278          void Delay(int num)//ÑÓÊ±º¯Êı
 279          {
 280   1              while(num--);
 281   1      }       
 282          
 283          
 284          /******************************************************************************/
 285          void Init_DS18B20(void)//³õÊ¼»¯ds1820
 286          {
 287   1              unsigned char x=0;
 288   1              DQ = 1;    //DQ¸´Î»
 289   1              Delay(8);  //ÉÔ×öÑÓÊ±
 290   1              DQ = 0;    //µ¥Æ¬»ú½«DQÀ­µÍ
 291   1              Delay(80); //¾«È·ÑÓÊ± ´óÓÚ 480us
 292   1              DQ = 1;    //À­¸ß×ÜÏß
 293   1              Delay(14);
 294   1              x=DQ;      //ÉÔ×öÑÓÊ±ºó Èç¹ûx=0Ôò³õÊ¼»¯³É¹¦ x=1Ôò³õÊ¼»¯Ê§°Ü
 295   1              Delay(20);
C51 COMPILER V7.08   WNL                                                                   04/09/2011 17:29:12 PAGE 6   

 296   1      }
 297          /******************************************************************************/
 298          unsigned char ReadOneChar(void)//¶ÁÒ»¸ö×Ö½Ú
 299          {
 300   1              unsigned char i=0;
 301   1              unsigned char dat = 0;
 302   1              for (i=8;i>0;i--)
 303   1              {
 304   2                      DQ = 0; // ¸øÂö³åĞÅºÅ
 305   2                      dat>>=1;
 306   2                      DQ = 1; // ¸øÂö³åĞÅºÅ
 307   2                      if(DQ)
 308   2                      dat|=0x80;
 309   2                      Delay(4);
 310   2              }
 311   1              return(dat);
 312   1      }
 313          
 314          /******************************************************************************/
 315          void WriteOneChar(unsigned char dat)//Ğ´Ò»¸ö×Ö½Ú
 316          {
 317   1              unsigned char i=0;
 318   1              for (i=8; i>0; i--)
 319   1              {
 320   2                      DQ = 0;
 321   2                      DQ = dat&0x01;
 322   2                      Delay(5);
 323   2                      DQ = 1;
 324   2                      dat>>=1;
 325   2              }
 326   1      }
 327          /******************************************************************************/
 328          unsigned int ReadTemperature(void)//¶ÁÈ¡ÎÂ¶È
 329          {
 330   1              unsigned char a=0;
 331   1              unsigned char b=0;
 332   1              unsigned int t=0;
 333   1              float tt=0;
 334   1              Init_DS18B20();
 335   1              WriteOneChar(0xCC); // Ìø¹ı¶ÁĞòºÅÁĞºÅµÄ²Ù×÷
 336   1              WriteOneChar(0x44); // Æô¶¯ÎÂ¶È×ª»»
 337   1              Init_DS18B20();
 338   1              WriteOneChar(0xCC); //Ìø¹ı¶ÁĞòºÅÁĞºÅµÄ²Ù×÷
 339   1              WriteOneChar(0xBE); //¶ÁÈ¡ÎÂ¶È¼Ä´æÆ÷
 340   1              a=ReadOneChar();  //¶ÁµÍ8Î»
 341   1              b=ReadOneChar(); //¶Á¸ß8Î»
 342   1              t=b;
 343   1              t<<=8;
 344   1              t=t|a;
 345   1              tt=t*0.0625;
 346   1              t= tt*10+0.5; //·Å´ó10±¶Êä³ö²¢ËÄÉáÎåÈë
 347   1              return(t);
 348   1      }
 349          /*****************************************************************************/
 350          //ÉùÃ÷
 351          void LCM_w_ss(void);
 352          void LCM_w_mm(void);
 353          void LCM_w_hh(void);
 354          void LCM_w_dd(void);
 355          void LCM_w_mo(void);
 356          void LCM_w_yy(void);
 357          void LCM_w_xq(void);
C51 COMPILER V7.08   WNL                                                                   04/09/2011 17:29:12 PAGE 7   

 358          void DS1302InputByte(unsigned char d) ;
 359          unsigned char DS1302OutputByte(void) ;
 360          void Init_1302(void);
 361          unsigned char Read1302(unsigned char);
 362          
 363          void Set_time(unsigned char sel);
 364          void Write1302(unsigned char , unsigned char );
 365          void updata (void);
 366          /*****************************************************************************/
 367          
 368          /*****************************************************************************/
 369          //µ÷Ê±ÓÃ¼Ó1³ÌĞò
 370          void Set_time(unsigned char sel)  //¸ù¾İÑ¡Ôñµ÷ÕûµÄÏàÓ¦ÏîÄ¿¼Ó1²¢Ğ´ÈëDS1302
 371          { 
 372   1        signed char address,item;
 373   1        signed char max,mini;
 374   1        LCM_WriteDatOrCom(0,0x9a);
 375   1        LCM_WriteString("µ÷Õû");
 376   1        //if(sel==6)  {LCM_WriteString("ÃëÖÓ");address=0x80; max=0;mini=0;}     //Ãë7
 377   1        if(sel==5)  {LCM_WriteString("·ÖÖÓ");address=0x82; max=59;mini=0;}    //·ÖÖÓ6
 378   1        if(sel==4)  {LCM_WriteString("Ğ¡Ê±");address=0x84; max=23;mini=0;}    //Ğ¡Ê±5
 379   1        if(sel==3)  {LCM_WriteString("ĞÇÆÚ");address=0x8a; max=7;mini=1;}    //ĞÇÆÚ4  
 380   1        if(sel==2)  {LCM_WriteString("ÈÕÆÚ");address=0x86; max=31;mini=1;}    //ÈÕ3
 381   1        if(sel==1)  {LCM_WriteString("ÔÂ·İ");address=0x88; max=12;mini=1;}    //ÔÂ2
 382   1        if(sel==0)  {LCM_WriteString("Äê·İ");address=0x8c; max=99; mini=0;}    //Äê1
 383   1        
 384   1        //¶ÁÈ¡1302Ä³µØÖ·ÉÏµÄÊıÖµ×ª»»³É10½øÖÆ¸³¸øitem 
 385   1        item=((Read1302(address+1))/16)*10 + (Read1302(address+1))%16;
 386   1        if(KEY_2 == 0)
 387   1       {
 388   2              item++;//Êı¼Ó 1  
 389   2        }
 390   1        if(KEY_4 == 0){
 391   2              item--;//Êı¼õ 1 
 392   2        }
 393   1        if(item>max) item=mini;//²é¿´ÊıÖµÓĞĞ§·¶Î§   
 394   1        if(item<mini) item=max;           
 395   1        Write1302(0x8e,0x00);//ÔÊĞíĞ´²Ù×÷
 396   1        Write1302(address,(item/10)*16+item%10);//×ª»»³É16½øÖÆĞ´Èë1302
 397   1        Write1302(0x8e,0x80);//Ğ´±£»¤£¬½ûÖ¹Ğ´²Ù×÷ 
 398   1        updata ();    //Ë¢ĞÂÊı¾İ
 399   1        LCM_w_mm();//Ë¢ĞÂ ·Ö 
 400   1         nl();
 401   1      }
 402          /*****************************************************************************/
 403          //ÉèÖÃ1302µÄ³õÊ¼Ê±¼ä
 404          void Init_1302(void)  //£¨2007Äê1ÔÂ1ÈÕ00Ê±00·Ö00ÃëĞÇÆÚÒ»£©
 405          {   uchar  cctt;
 406   1          cctt=Read1302(0x80);
 407   1         if(cctt&0x80)
 408   1              {
 409   2          Write1302(0x8e,0x00);//ÔÊĞíĞ´²Ù×÷
 410   2              Write1302(0x8c,0x08);//Äê
 411   2              Write1302(0x8a,0x02);//ĞÇÆÚ
 412   2              Write1302(0x88,0x01);//ÔÂ
 413   2              Write1302(0x86,0x01);//ÈÕ
 414   2              Write1302(0x84,0x00);//Ğ¡Ê±
 415   2              Write1302(0x82,0x00);//·ÖÖÓ
 416   2              Write1302(0x80,0x00);//Ãë
 417   2      //      Write1302(0x90,0x55);//³äµç     
 418   2              Write1302(0x8e,0x80);//½ûÖ¹Ğ´²Ù×÷
 419   2         }
C51 COMPILER V7.08   WNL                                                                   04/09/2011 17:29:12 PAGE 8   

 420   1      }
 421          void DS1302InputByte(unsigned char d)   //ÊµÊ±Ê±ÖÓĞ´ÈëÒ»×Ö½Ú(ÄÚ²¿º¯Êı)
 422          { 
 423   1          unsigned char i;
 424   1          ACC = d;
 425   1          for(i=8; i>0; i--)
 426   1          {
 427   2              DS1302_IO = ACC0;               //Ïàµ±ÓÚ»ã±àÖĞµÄ RRC
 428   2              DS1302_CLK = 1;
 429   2              DS1302_CLK = 0;
 430   2              ACC = ACC >> 1; 
 431   2          } 
 432   1      }
 433          
 434          unsigned char DS1302OutputByte(void)    //ÊµÊ±Ê±ÖÓ¶ÁÈ¡Ò»×Ö½Ú(ÄÚ²¿º¯Êı)
 435          { 
 436   1          unsigned char i;
 437   1          for(i=8; i>0; i--)
 438   1          {
 439   2              ACC = ACC >>1;                          //Ïàµ±ÓÚ»ã±àÖĞµÄ RRC 
 440   2              ACC7 = DS1302_IO;
 441   2              DS1302_CLK = 1;
 442   2              DS1302_CLK = 0;
 443   2          } 
 444   1          return(ACC); 
 445   1      }
 446          
 447          void Write1302(unsigned char ucAddr, unsigned char ucDa)        //ucAddr: DS1302µØÖ·, ucData: ÒªĞ´µÄÊı¾İ
 448          {
 449   1          DS1302_RST = 0;
 450   1          DS1302_CLK = 0;
 451   1          DS1302_RST = 1;
 452   1          DS1302InputByte(ucAddr);            // µØÖ·£¬ÃüÁî 
 453   1          DS1302InputByte(ucDa);              // Ğ´1ByteÊı¾İ
 454   1          DS1302_CLK = 1;
 455   1          DS1302_RST = 0;
 456   1      } 
 457          
 458          unsigned char Read1302(unsigned char ucAddr)    //¶ÁÈ¡DS1302Ä³µØÖ·µÄÊı¾İ
 459          {
 460   1          unsigned char ucData;
 461   1          DS1302_RST = 0;
 462   1          DS1302_CLK = 0;
 463   1          DS1302_RST = 1;
 464   1          DS1302InputByte(ucAddr|0x01);        // µØÖ·£¬ÃüÁî 
 465   1          ucData = DS1302OutputByte();         // ¶Á1ByteÊı¾İ
 466   1          DS1302_CLK = 1;
 467   1          DS1302_RST = 0;
 468   1          return(ucData);
 469   1      }
 470          /*****************************************************************************/
 471          //ÏòLCMÖĞÌîĞ´ Äê Êı¾İ
 472          void LCM_w_yy(void){
 473   1              //if(Read1302(0x8d) != yy){
 474   1                      yy = Read1302(0x8d);
 475   1                      LCM_WriteDatOrCom(0,0x80);
 476   1                      LCM_WriteString("20");
 477   1                      LCM_WriteDatOrCom(0,0x81);
 478   1                      LCM_WriteDatOrCom(1,(yy/16)+0x30);      
 479   1                      LCM_WriteDatOrCom(1,yy%16+0x30);
 480   1                      LCM_WriteDatOrCom(0,0x82);
 481   1                      LCM_WriteString("Äê");   
C51 COMPILER V7.08   WNL                                                                   04/09/2011 17:29:12 PAGE 9   

 482   1              nl();    
 483   1      }       //}
 484          /*****************************************************************************/
 485          //ÏòLCMÖĞÌîĞ´ ÔÂ Êı¾İ
 486          void LCM_w_mo(void){
 487   1              //if(Read1302(0x89) != mo){
 488   1                      mo = Read1302(0x89);
 489   1                      LCM_WriteDatOrCom(0,0x83);
 490   1                              if(mo/16 != 0){LCM_WriteDatOrCom(1,(mo/16)+0x30);}      //Ê®Î»ÏûÒş
 491   1                              else{LCM_WriteDatOrCom(1,0x20);}//Í¬ÉÏ                  
 492   1                      LCM_WriteDatOrCom(1,mo%16+0x30);
 493   1                      LCM_WriteDatOrCom(0,0x84);
 494   1                      LCM_WriteString("ÔÂ");
 495   1              nl();
 496   1      }       //}
 497          /*****************************************************************************/
 498          //ĞÇÆÚ´¦Àí²¢ËÍÈëLCMµÄÖ¸¶¨ÇøÓò
 499          void LCM_w_xq(void){
 500   1              unsigned char sel;
 501   1      
 502   1              //if(Read1302(0x8b) != xq){
 503   1              xq = Read1302(0x8b);
 504   1              sel = (Read1302(0x8b))%16; //×Ö½ÚµÍ4Î»µÄBCDÂë·ÅÈësel
 505   1              LCM_WriteDatOrCom(0,0x97);//Ğ´ÈëÖ¸¶¨ÇøÓò£¨97H µÚ¶şĞĞµÚ8¸ö×Ö£©
 506   1              if(sel==7)  {LCM_WriteString("ÈÕ");}    //
 507   1              if(sel==6)  {LCM_WriteString("Áù");}    //
 508   1              if(sel==5)  {LCM_WriteString("Îå");}    //
 509   1              if(sel==4)  {LCM_WriteString("ËÄ");}    //
 510   1              if(sel==3)  {LCM_WriteDatOrCom(1,0xc8);LCM_WriteDatOrCom(1,0xfd);} //´ËÖ¸ÁîµÈÓÚLCM_WriteString("Èı"); Ò
             -òÎª"Èı"µÄÄÚÂëÊ§Ğ§¡£
 511   1              if(sel==2)  {LCM_WriteString("¶ş");}    //
 512   1              if(sel==1)  {LCM_WriteString("Ò»");}    //ĞÇÆÚÒ»
 513   1              LCM_WriteDatOrCom(0,0x95);
 514   1              LCM_WriteString("ĞÇÆÚ");
 515   1              //}
 516   1      }
 517          /*****************************************************************************/
 518          //ÏòLCMÖĞÌîĞ´ ÈÕ Êı¾İ
 519          void LCM_w_dd(void){
 520   1      //      if(Read1302(0x87) != dd){
 521   1                      dd = Read1302(0x87);
 522   1                      LCM_WriteDatOrCom(0,0x85);
 523   1                              if(dd/16 != 0){LCM_WriteDatOrCom(1,(dd/16)+0x30);}      //Ê®Î»ÏûÒş
 524   1                              else{LCM_WriteDatOrCom(1,0x20);}//Í¬ÉÏ  
 525   1                      LCM_WriteDatOrCom(1,dd%16+0x30);
 526   1                      LCM_WriteDatOrCom(0,0x86);
 527   1                      LCM_WriteString("ÈÕ  ");
 528   1              nl();
 529   1                                      
 530   1      }       //}
 531          /*****************************************************************************/
 532          //ÏòLCMÖĞÌîĞ´ Ğ¡Ê± Êı¾İ
 533          void LCM_w_hh(void){
 534   1              if(Read1302(0x85) != hh){
 535   2                      hh = Read1302(0x85);
 536   2                              if (hh > 0x07 && hh < 0x22 && w == 0){
 537   3                                      beep = 0; 
 538   3                                      DelayM(100);
 539   3                                      beep = 1; 
 540   3                              }
 541   2                      }
 542   1                      LCM_WriteDatOrCom(0,0x88);
C51 COMPILER V7.08   WNL                                                                   04/09/2011 17:29:12 PAGE 10  

 543   1                      LCM_WriteDatOrCom(1,(hh/16)+0x30);
 544   1                      LCM_WriteDatOrCom(1,hh%16+0x30);
 545   1                                      
 546   1      }       //}
 547          /*****************************************************************************/
 548          //ÏòLCMÖĞÌîĞ´ ·ÖÖÓ Êı¾İ
 549          void LCM_w_mm(void){
 550   1              if(Read1302(0x83) != mm){               
 551   2                      mm = Read1302(0x83);
 552   2                      if( w == 0){                            
 553   3                              days();    //½ÚÈÕÏÔÊ¾
 554   3                              updata ();      //Ë¢ĞÂÊı¾İ
 555   3                      }                               
 556   2              }
 557   1              LCM_WriteDatOrCom(0,0x89);      
 558   1              LCM_WriteDatOrCom(1,0x3a);        //":"
 559   1              LCM_WriteDatOrCom(1,(mm/16)+0x30);
 560   1              LCM_WriteDatOrCom(1,mm%16+0x30);
 561   1              LCM_WriteDatOrCom(1,0x3a);       //"."  
 562   1      }
 563          /*****************************************************************************/
 564          //Ë¢ĞÂÊı¾İ
 565          void updata (void){
 566   1                      LCM_w_hh();//Ë¢ĞÂ Ğ¡Ê± 
 567   1                      LCM_w_dd();//Ë¢ĞÂ ÈÕ
 568   1                      LCM_w_xq();//¸üĞÂĞÇÆÚÖµ 
 569   1                      LCM_w_mo();//Ë¢ĞÂ ÔÂ
 570   1                      LCM_w_yy();//Ë¢ĞÂ Äê
 571   1                        nl();
 572   1      }
 573          /*****************************************************************************/
 574          //ÏòLCMÖĞÌîĞ´ Ãë Êı¾İ
 575          void LCM_w_ss(void){
 576   1              unsigned int i=0;
 577   1              unsigned char a=0,b=0,c=0;
 578   1              if(Read1302(0x81) != ss){       //ÅĞ¶ÏÊÇ·ñĞèÒª¸üĞÂ
 579   2                      ss = Read1302(0x81);    //¸üĞÂÊı¾İ
 580   2                      LCM_WriteDatOrCom(0,0x8b);              //ÃëÖµÔÚLCMÉÏµÄĞ´ÈëÎ»ÖÃ
 581   2                      LCM_WriteDatOrCom(1,(ss/16)+0x30);      //Ğ´Ê®Î»                
 582   2                      LCM_WriteDatOrCom(1,ss%16+0x30);        //Ğ´¸öÎ»
 583   2                      LCM_w_mm();//Ë¢ĞÂ ·Ö
 584   2              nl();           
 585   2              LCM_WriteDatOrCom(0,0x8d);              //ÎÂ¶ÈÔÚLCMÉÏµÄĞ´ÈëÎ»ÖÃ         
 586   2              i=ReadTemperature();//¶ÁÎÂ¶È²¢ËÍÏÔ
 587   2              a=i/100;
 588   2              LCM_WriteDatOrCom(1,a+0x30);    //ÏÔÊ¾ÎÂ¶ÈÊ®Î»
 589   2              b=i/10-a*10;
 590   2              LCM_WriteDatOrCom(1,b+0x30);    //¸öÎ»
 591   2              LCM_WriteDatOrCom(1,0x2e);       //"."
 592   2              c=i-a*100-b*10;
 593   2              LCM_WriteDatOrCom(1,c+0x30); //Ğ¡Î»1Î»          
 594   2              LCM_WriteString("¡æ");  //¶ÈC
 595   2      }       }
 596          
 597          
 598          
 599          
 600          //********ÑôÀú×ª»»ÒõÀú************************************
 601          code uchar year_code[597]={
 602                              0x04,0xAe,0x53,    //1901 0
 603                              0x0A,0x57,0x48,    //1902 3
 604                              0x55,0x26,0xBd,    //1903 6
C51 COMPILER V7.08   WNL                                                                   04/09/2011 17:29:12 PAGE 11  

 605                              0x0d,0x26,0x50,    //1904 9
 606                              0x0d,0x95,0x44,    //1905 12
 607                              0x46,0xAA,0xB9,    //1906 15
 608                              0x05,0x6A,0x4d,    //1907 18
 609                              0x09,0xAd,0x42,    //1908 21
 610                              0x24,0xAe,0xB6,    //1909
 611                              0x04,0xAe,0x4A,    //1910
 612                              0x6A,0x4d,0xBe,    //1911
 613                              0x0A,0x4d,0x52,    //1912
 614                              0x0d,0x25,0x46,    //1913
 615                              0x5d,0x52,0xBA,    //1914
 616                              0x0B,0x54,0x4e,    //1915
 617                              0x0d,0x6A,0x43,    //1916
 618                              0x29,0x6d,0x37,    //1917
 619                              0x09,0x5B,0x4B,    //1918
 620                              0x74,0x9B,0xC1,    //1919
 621                              0x04,0x97,0x54,    //1920
 622                              0x0A,0x4B,0x48,    //1921
 623                              0x5B,0x25,0xBC,    //1922
 624                              0x06,0xA5,0x50,    //1923
 625                              0x06,0xd4,0x45,    //1924
 626                              0x4A,0xdA,0xB8,    //1925
 627                              0x02,0xB6,0x4d,    //1926
 628                              0x09,0x57,0x42,    //1927
 629                              0x24,0x97,0xB7,    //1928
 630                              0x04,0x97,0x4A,    //1929
 631                              0x66,0x4B,0x3e,    //1930
 632                              0x0d,0x4A,0x51,    //1931
 633                              0x0e,0xA5,0x46,    //1932
 634                              0x56,0xd4,0xBA,    //1933
 635                              0x05,0xAd,0x4e,    //1934
 636                              0x02,0xB6,0x44,    //1935
 637                              0x39,0x37,0x38,    //1936
 638                              0x09,0x2e,0x4B,    //1937
 639                              0x7C,0x96,0xBf,    //1938
 640                              0x0C,0x95,0x53,    //1939
 641                              0x0d,0x4A,0x48,    //1940
 642                              0x6d,0xA5,0x3B,    //1941
 643                              0x0B,0x55,0x4f,    //1942
 644                              0x05,0x6A,0x45,    //1943
 645                              0x4A,0xAd,0xB9,    //1944
 646                              0x02,0x5d,0x4d,    //1945
 647                              0x09,0x2d,0x42,    //1946
 648                              0x2C,0x95,0xB6,    //1947
 649                              0x0A,0x95,0x4A,    //1948
 650                              0x7B,0x4A,0xBd,    //1949
 651                              0x06,0xCA,0x51,    //1950
 652                              0x0B,0x55,0x46,    //1951
 653                              0x55,0x5A,0xBB,    //1952
 654                              0x04,0xdA,0x4e,    //1953
 655                              0x0A,0x5B,0x43,    //1954
 656                              0x35,0x2B,0xB8,    //1955
 657                              0x05,0x2B,0x4C,    //1956
 658                              0x8A,0x95,0x3f,    //1957
 659                              0x0e,0x95,0x52,    //1958
 660                              0x06,0xAA,0x48,    //1959
 661                              0x7A,0xd5,0x3C,    //1960
 662                              0x0A,0xB5,0x4f,    //1961
 663                              0x04,0xB6,0x45,    //1962
 664                              0x4A,0x57,0x39,    //1963
 665                              0x0A,0x57,0x4d,    //1964
 666                              0x05,0x26,0x42,    //1965
C51 COMPILER V7.08   WNL                                                                   04/09/2011 17:29:12 PAGE 12  

 667                              0x3e,0x93,0x35,    //1966
 668                              0x0d,0x95,0x49,    //1967
 669                              0x75,0xAA,0xBe,    //1968
 670                              0x05,0x6A,0x51,    //1969
 671                              0x09,0x6d,0x46,    //1970
 672                              0x54,0xAe,0xBB,    //1971
 673                              0x04,0xAd,0x4f,    //1972
 674                              0x0A,0x4d,0x43,    //1973
 675                              0x4d,0x26,0xB7,    //1974
 676                              0x0d,0x25,0x4B,    //1975
 677                              0x8d,0x52,0xBf,    //1976
 678                              0x0B,0x54,0x52,    //1977
 679                              0x0B,0x6A,0x47,    //1978
 680                              0x69,0x6d,0x3C,    //1979
 681                              0x09,0x5B,0x50,    //1980
 682                              0x04,0x9B,0x45,    //1981
 683                              0x4A,0x4B,0xB9,    //1982
 684                              0x0A,0x4B,0x4d,    //1983
 685                              0xAB,0x25,0xC2,    //1984
 686                              0x06,0xA5,0x54,    //1985
 687                              0x06,0xd4,0x49,    //1986
 688                              0x6A,0xdA,0x3d,    //1987
 689                              0x0A,0xB6,0x51,    //1988
 690                              0x09,0x37,0x46,    //1989
 691                              0x54,0x97,0xBB,    //1990
 692                              0x04,0x97,0x4f,    //1991
 693                              0x06,0x4B,0x44,    //1992
 694                              0x36,0xA5,0x37,    //1993
 695                              0x0e,0xA5,0x4A,    //1994
 696                              0x86,0xB2,0xBf,    //1995
 697                              0x05,0xAC,0x53,    //1996
 698                              0x0A,0xB6,0x47,    //1997
 699                              0x59,0x36,0xBC,    //1998
 700                              0x09,0x2e,0x50,    //1999 294
 701                              0x0C,0x96,0x45,    //2000 297
 702                              0x4d,0x4A,0xB8,    //2001
 703                              0x0d,0x4A,0x4C,    //2002
 704                              0x0d,0xA5,0x41,    //2003
 705                              0x25,0xAA,0xB6,    //2004
 706                              0x05,0x6A,0x49,    //2005
 707                              0x7A,0xAd,0xBd,    //2006
 708                              0x02,0x5d,0x52,    //2007
 709                              0x09,0x2d,0x47,    //2008
 710                              0x5C,0x95,0xBA,    //2009
 711                              0x0A,0x95,0x4e,    //2010
 712                              0x0B,0x4A,0x43,    //2011
 713                              0x4B,0x55,0x37,    //2012
 714                              0x0A,0xd5,0x4A,    //2013
 715                              0x95,0x5A,0xBf,    //2014
 716                              0x04,0xBA,0x53,    //2015
 717                              0x0A,0x5B,0x48,    //2016
 718                              0x65,0x2B,0xBC,    //2017
 719                              0x05,0x2B,0x50,    //2018
 720                              0x0A,0x93,0x45,    //2019
 721                              0x47,0x4A,0xB9,    //2020
 722                              0x06,0xAA,0x4C,    //2021
 723                              0x0A,0xd5,0x41,    //2022
 724                              0x24,0xdA,0xB6,    //2023
 725                              0x04,0xB6,0x4A,    //2024
 726                              0x69,0x57,0x3d,    //2025
 727                              0x0A,0x4e,0x51,    //2026
 728                              0x0d,0x26,0x46,    //2027
C51 COMPILER V7.08   WNL                                                                   04/09/2011 17:29:12 PAGE 13  

 729                              0x5e,0x93,0x3A,    //2028
 730                              0x0d,0x53,0x4d,    //2029
 731                              0x05,0xAA,0x43,    //2030
 732                              0x36,0xB5,0x37,    //2031
 733                              0x09,0x6d,0x4B,    //2032
 734                              0xB4,0xAe,0xBf,    //2033
 735                              0x04,0xAd,0x53,    //2034
 736                              0x0A,0x4d,0x48,    //2035
 737                              0x6d,0x25,0xBC,    //2036
 738                              0x0d,0x25,0x4f,    //2037
 739                              0x0d,0x52,0x44,    //2038
 740                              0x5d,0xAA,0x38,    //2039
 741                              0x0B,0x5A,0x4C,    //2040
 742                              0x05,0x6d,0x41,    //2041
 743                              0x24,0xAd,0xB6,    //2042
 744                              0x04,0x9B,0x4A,    //2043
 745                              0x7A,0x4B,0xBe,    //2044
 746                              0x0A,0x4B,0x51,    //2045
 747                              0x0A,0xA5,0x46,    //2046
 748                              0x5B,0x52,0xBA,    //2047
 749                              0x06,0xd2,0x4e,    //2048
 750                              0x0A,0xdA,0x42,    //2049
 751                              0x35,0x5B,0x37,    //2050
 752                              0x09,0x37,0x4B,    //2051
 753                              0x84,0x97,0xC1,    //2052
 754                              0x04,0x97,0x53,    //2053
 755                              0x06,0x4B,0x48,    //2054
 756                              0x66,0xA5,0x3C,    //2055
 757                              0x0e,0xA5,0x4f,    //2056
 758                              0x06,0xB2,0x44,    //2057
 759                              0x4A,0xB6,0x38,    //2058
 760                              0x0A,0xAe,0x4C,    //2059
 761                              0x09,0x2e,0x42,    //2060
 762                              0x3C,0x97,0x35,    //2061
 763                              0x0C,0x96,0x49,    //2062
 764                              0x7d,0x4A,0xBd,    //2063
 765                              0x0d,0x4A,0x51,    //2064
 766                              0x0d,0xA5,0x45,    //2065
 767                              0x55,0xAA,0xBA,    //2066
 768                              0x05,0x6A,0x4e,    //2067
 769                              0x0A,0x6d,0x43,    //2068
 770                              0x45,0x2e,0xB7,    //2069
 771                              0x05,0x2d,0x4B,    //2070
 772                              0x8A,0x95,0xBf,    //2071
 773                              0x0A,0x95,0x53,    //2072
 774                              0x0B,0x4A,0x47,    //2073
 775                              0x6B,0x55,0x3B,    //2074
 776                              0x0A,0xd5,0x4f,    //2075
 777                              0x05,0x5A,0x45,    //2076
 778                              0x4A,0x5d,0x38,    //2077
 779                              0x0A,0x5B,0x4C,    //2078
 780                              0x05,0x2B,0x42,    //2079
 781                              0x3A,0x93,0xB6,    //2080
 782                              0x06,0x93,0x49,    //2081
 783                              0x77,0x29,0xBd,    //2082
 784                              0x06,0xAA,0x51,    //2083
 785                              0x0A,0xd5,0x46,    //2084
 786                              0x54,0xdA,0xBA,    //2085
 787                              0x04,0xB6,0x4e,    //2086
 788                              0x0A,0x57,0x43,    //2087
 789                              0x45,0x27,0x38,    //2088
 790                              0x0d,0x26,0x4A,    //2089
C51 COMPILER V7.08   WNL                                                                   04/09/2011 17:29:12 PAGE 14  

 791                              0x8e,0x93,0x3e,    //2090
 792                              0x0d,0x52,0x52,    //2091
 793                              0x0d,0xAA,0x47,    //2092
 794                              0x66,0xB5,0x3B,    //2093
 795                              0x05,0x6d,0x4f,    //2094
 796                              0x04,0xAe,0x45,    //2095
 797                              0x4A,0x4e,0xB9,    //2096
 798                              0x0A,0x4d,0x4C,    //2097
 799                              0x0d,0x15,0x41,    //2098
 800                              0x2d,0x92,0xB5,    //2099
 801          };
 802          ///ÔÂ·İÊı¾İ±í
 803          code uchar day_code1[9]={0x0,0x1f,0x3b,0x5a,0x78,0x97,0xb5,0xd4,0xf3};
 804          code uint day_code2[3]={0x111,0x130,0x14e};
 805          /*
 806          º¯Êı¹¦ÄÜ:ÊäÈëBCDÑôÀúÊı¾İ,Êä³öBCDÒõÀúÊı¾İ(Ö»ÔÊĞí1901-2099Äê)
 807          µ÷ÓÃº¯ÊıÊ¾Àı:Conversion(c_sun,year_sun,month_sun,day_sun)
 808          Èç:¼ÆËã2004Äê10ÔÂ16ÈÕConversion(0,0x4,0x10,0x16);
 809          c_sun,year_sun,month_sun,day_sun¾ùÎªBCDÊı¾İ,c_sunÎªÊÀ¼Í±êÖ¾Î»,c_sun=0Îª21ÊÀ
 810          ¼Í,c_sun=1Îª19ÊÀ¼Í
 811          µ÷ÓÃº¯Êıºó,Ô­ÓĞÊı¾İ²»±ä,¶Ác_moon,year_moon,month_moon,day_moonµÃ³öÒõÀúBCDÊı¾İ
 812          */
 813          bit c_moon;
 814          data uchar year_moon,month_moon,day_moon,week;
 815          /*×Óº¯Êı,ÓÃÓÚ¶ÁÈ¡Êı¾İ±íÖĞÅ©ÀúÔÂµÄ´óÔÂ»òĞ¡ÔÂ,Èç¹û¸ÃÔÂÎª´ó·µ»Ø1,ÎªĞ¡·µ»Ø0*/
 816          bit get_moon_day(uchar month_p,uint table_addr)
 817          {
 818   1              uchar temp;
 819   1          switch (month_p){
 820   2              case 1:{temp=year_code[table_addr]&0x08;
 821   3                   if (temp==0)return(0);else return(1);}
 822   2              case 2:{temp=year_code[table_addr]&0x04;
 823   3                   if (temp==0)return(0);else return(1);}
 824   2              case 3:{temp=year_code[table_addr]&0x02;
 825   3                   if (temp==0)return(0);else return(1);}
 826   2              case 4:{temp=year_code[table_addr]&0x01;
 827   3                   if (temp==0)return(0);else return(1);}
 828   2              case 5:{temp=year_code[table_addr+1]&0x80;
 829   3                   if (temp==0) return(0);else return(1);}
 830   2              case 6:{temp=year_code[table_addr+1]&0x40;
 831   3                   if (temp==0)return(0);else return(1);}
 832   2              case 7:{temp=year_code[table_addr+1]&0x20;
 833   3                   if (temp==0)return(0);else return(1);}
 834   2              case 8:{temp=year_code[table_addr+1]&0x10;
 835   3                   if (temp==0)return(0);else return(1);}
 836   2              case 9:{temp=year_code[table_addr+1]&0x08;
 837   3                   if (temp==0)return(0);else return(1);}
 838   2              case 10:{temp=year_code[table_addr+1]&0x04;
 839   3                   if (temp==0)return(0);else return(1);}
 840   2              case 11:{temp=year_code[table_addr+1]&0x02;
 841   3                   if (temp==0)return(0);else return(1);}
 842   2              case 12:{temp=year_code[table_addr+1]&0x01;
 843   3                   if (temp==0)return(0);else return(1);}
 844   2              case 13:{temp=year_code[table_addr+2]&0x80;
 845   3                   if (temp==0)return(0);else return(1);}
 846   2          }
 847   1      }
 848          /*
 849          º¯Êı¹¦ÄÜ:ÊäÈëBCDÑôÀúÊı¾İ,Êä³öBCDÒõÀúÊı¾İ(Ö»ÔÊĞí1901-2099Äê)
 850          µ÷ÓÃº¯ÊıÊ¾Àı:Conversion(c_sun,year_sun,month_sun,day_sun)
 851          Èç:¼ÆËã2004Äê10ÔÂ16ÈÕConversion(0,0x4,0x10,0x16);
 852          c_sun,year_sun,month_sun,day_sun¾ùÎªBCDÊı¾İ,c_sunÎªÊÀ¼Í±êÖ¾Î»,c_sun=0Îª21ÊÀ
C51 COMPILER V7.08   WNL                                                                   04/09/2011 17:29:12 PAGE 15  

 853          ¼Í,c_sun=1Îª19ÊÀ¼Í
 854          µ÷ÓÃº¯Êıºó,Ô­ÓĞÊı¾İ²»±ä,¶Ác_moon,year_moon,month_moon,day_moonµÃ³öÒõÀúBCDÊı¾İ
 855          */
 856          void Conversion(bit c,uchar year,uchar month,uchar day)
 857          {                         //c=0 Îª21ÊÀ¼Í,c=1 Îª19ÊÀ¼Í ÊäÈëÊä³öÊı¾İ¾ùÎªBCDÊı¾İ
 858   1          uchar temp1,temp2,temp3,month_p;
 859   1          uint temp4,table_addr;
 860   1          bit flag2,flag_y;
 861   1          temp1=year/16;   //BCD->hex ÏÈ°ÑÊı¾İ×ª»»ÎªÊ®Áù½øÖÆ
 862   1          temp2=year%16;
 863   1          year=temp1*10+temp2;
 864   1          temp1=month/16;
 865   1          temp2=month%16;
 866   1          month=temp1*10+temp2;
 867   1          temp1=day/16;
 868   1          temp2=day%16;
 869   1          day=temp1*10+temp2;
 870   1          //¶¨Î»Êı¾İ±íµØÖ·
 871   1          if(c==0){                   
 872   2              table_addr=(year+0x64-1)*0x3;
 873   2          }
 874   1          else {
 875   2              table_addr=(year-1)*0x3;
 876   2          }
 877   1          //¶¨Î»Êı¾İ±íµØÖ·Íê³É
 878   1          //È¡µ±Äê´º½ÚËùÔÚµÄ¹«ÀúÔÂ·İ
 879   1          temp1=year_code[table_addr+2]&0x60; 
 880   1          temp1=_cror_(temp1,5);
 881   1          //È¡µ±Äê´º½ÚËùÔÚµÄ¹«ÀúÔÂ·İÍê³É
 882   1          //È¡µ±Äê´º½ÚËùÔÚµÄ¹«ÀúÈÕ
 883   1          temp2=year_code[table_addr+2]&0x1f; 
 884   1          //È¡µ±Äê´º½ÚËùÔÚµÄ¹«ÀúÈÕÍê³É
 885   1          // ¼ÆËãµ±Äê´ºÄêÀëµ±ÄêÔªµ©µÄÌìÊı,´º½ÚÖ»»áÔÚ¹«Àú1ÔÂ»ò2ÔÂ
 886   1          if(temp1==0x1){  
 887   2              temp3=temp2-1;  
 888   2          }  
 889   1          else{
 890   2              temp3=temp2+0x1f-1;        
 891   2          }
 892   1          // ¼ÆËãµ±Äê´ºÄêÀëµ±ÄêÔªµ©µÄÌìÊıÍê³É
 893   1          //¼ÆËã¹«ÀúÈÕÀëµ±ÄêÔªµ©µÄÌìÊı,ÎªÁË¼õÉÙÔËËã,ÓÃÁËÁ½¸ö±í
 894   1          //day_code1[9],day_code2[3]
 895   1          //Èç¹û¹«ÀúÔÂÔÚ¾ÅÔÂ»òÇ°,ÌìÊı»áÉÙÓÚ0xff,ÓÃ±íday_code1[9],
 896   1          //ÔÚ¾ÅÔÂºó,ÌìÊı´óÓÚ0xff,ÓÃ±íday_code2[3]
 897   1          //ÈçÊäÈë¹«ÀúÈÕÎª8ÔÂ10ÈÕ,Ôò¹«ÀúÈÕÀëÔªµ©ÌìÊıÎªday_code1[8-1]+10-1
 898   1          //ÈçÊäÈë¹«ÀúÈÕÎª11ÔÂ10ÈÕ,Ôò¹«ÀúÈÕÀëÔªµ©ÌìÊıÎªday_code2[11-10]+10-1
 899   1          if (month<10){ 
 900   2              temp4=day_code1[month-1]+day-1;
 901   2          }
 902   1          else{
 903   2              temp4=day_code2[month-10]+day-1;
 904   2          }
 905   1          if ((month>0x2)&&(year%0x4==0)){  //Èç¹û¹«ÀúÔÂ´óÓÚ2ÔÂ²¢ÇÒ¸ÃÄêµÄ2ÔÂÎªÈòÔÂ,ÌìÊı¼Ó1
 906   2              temp4+=1;
 907   2          }
 908   1          //¼ÆËã¹«ÀúÈÕÀëµ±ÄêÔªµ©µÄÌìÊıÍê³É
 909   1          //ÅĞ¶Ï¹«ÀúÈÕÔÚ´º½ÚÇ°»¹ÊÇ´º½Úºó
 910   1          if (temp4>=temp3){ //¹«ÀúÈÕÔÚ´º½Úºó»ò¾ÍÊÇ´º½Úµ±ÈÕÊ¹ÓÃÏÂÃæ´úÂë½øĞĞÔËËã
 911   2              temp4-=temp3;
 912   2              month=0x1;
 913   2              month_p=0x1;  //month_pÎªÔÂ·İÖ¸Ïò,¹«ÀúÈÕÔÚ´º½ÚÇ°»ò¾ÍÊÇ´º½Úµ±ÈÕmonth_pÖ¸ÏòÊ×ÔÂ
 914   2              flag2=get_moon_day(month_p,table_addr); //¼ì²é¸ÃÅ©ÀúÔÂÎª´óĞ¡»¹ÊÇĞ¡ÔÂ,´óÔÂ·µ»Ø1,Ğ¡ÔÂ·µ»Ø0
C51 COMPILER V7.08   WNL                                                                   04/09/2011 17:29:12 PAGE 16  

 915   2              flag_y=0;
 916   2              if(flag2==0)temp1=0x1d; //Ğ¡ÔÂ29Ìì
 917   2              else temp1=0x1e; //´óĞ¡30Ìì
 918   2              temp2=year_code[table_addr]&0xf0;
 919   2              temp2=_cror_(temp2,4);  //´ÓÊı¾İ±íÖĞÈ¡¸ÃÄêµÄÈòÔÂÔÂ·İ,ÈçÎª0Ôò¸ÃÄêÎŞÈòÔÂ
 920   2              while(temp4>=temp1){
 921   3                  temp4-=temp1;
 922   3                  month_p+=1;
 923   3                  if(month==temp2){
 924   4                  flag_y=~flag_y;
 925   4                  if(flag_y==0)month+=1;
 926   4                  }
 927   3                  else month+=1;
 928   3                  flag2=get_moon_day(month_p,table_addr);
 929   3                  if(flag2==0)temp1=0x1d;
 930   3                  else temp1=0x1e;
 931   3              }
 932   2              day=temp4+1;
 933   2          }
 934   1          else{  //¹«ÀúÈÕÔÚ´º½ÚÇ°Ê¹ÓÃÏÂÃæ´úÂë½øĞĞÔËËã
 935   2              temp3-=temp4;
 936   2              if (year==0x0){year=0x63;c=1;}
 937   2              else year-=1;
 938   2              table_addr-=0x3;
 939   2              month=0xc;
 940   2              temp2=year_code[table_addr]&0xf0;
 941   2              temp2=_cror_(temp2,4);
 942   2              if (temp2==0)month_p=0xc; 
 943   2              else month_p=0xd; //
 944   2              /*
 945   2              month_pÎªÔÂ·İÖ¸Ïò,Èç¹ûµ±ÄêÓĞÈòÔÂ,Ò»ÄêÓĞÊ®Èı¸öÔÂ,ÔÂÖ¸Ïò13,
 946   2      ÎŞÈòÔÂÖ¸Ïò12
 947   2              */
 948   2              flag_y=0;
 949   2              flag2=get_moon_day(month_p,table_addr);
 950   2              if(flag2==0)temp1=0x1d;
 951   2              else temp1=0x1e;
 952   2              while(temp3>temp1){
 953   3                  temp3-=temp1;
 954   3                  month_p-=1;
 955   3                  if(flag_y==0)month-=1;
 956   3                  if(month==temp2)flag_y=~flag_y;
 957   3                  flag2=get_moon_day(month_p,table_addr);
 958   3                  if(flag2==0)temp1=0x1d;
 959   3                  else temp1=0x1e;
 960   3               }
 961   2              day=temp1-temp3+1;
 962   2          }
 963   1          c_moon=c;                 //HEX->BCD ,ÔËËã½áÊøºó,°ÑÊı¾İ×ª»»ÎªBCDÊı¾İ
 964   1          temp1=year/10;
 965   1          temp1=_crol_(temp1,4);
 966   1          temp2=year%10;
 967   1          year_moon=temp1|temp2;
 968   1          temp1=month/10;
 969   1          temp1=_crol_(temp1,4);
 970   1          temp2=month%10;
 971   1          month_moon=temp1|temp2;
 972   1          temp1=day/10;
 973   1          temp1=_crol_(temp1,4);
 974   1          temp2=day%10;
 975   1          day_moon=temp1|temp2;
 976   1      }
C51 COMPILER V7.08   WNL                                                                   04/09/2011 17:29:12 PAGE 17  

 977          
 978          
 979          void nl()
 980          {
 981   1       unsigned char   yy1,yy2;
 982   1      
 983   1       Conversion(0,yy,mo,dd);
 984   1       LCM_WriteDatOrCom(0,0x90);
 985   1       LCM_WriteString("20");
 986   1       LCM_WriteDatOrCom(1,year_moon/16+'0');
 987   1       LCM_WriteDatOrCom(1,year_moon%16+'0');
 988   1       LCM_WriteDatOrCom(1,'/');
 989   1       LCM_WriteDatOrCom(1,month_moon/16+'0');
 990   1       LCM_WriteDatOrCom(1,month_moon%16+'0');
 991   1       LCM_WriteDatOrCom(1,'/');
 992   1       LCM_WriteDatOrCom(1,day_moon/16+'0');
 993   1       LCM_WriteDatOrCom(1,day_moon%16+'0');
 994   1       yy1=(year_moon/16)*10+year_moon%16;
 995   1       yy2=yy1%12;
 996   1       switch(yy2)
 997   1       {
 998   2        case 0: LCM_WriteDatOrCom(0,0x87);LCM_WriteString("Áú");
 999   2                break;
1000   2        case 1: LCM_WriteDatOrCom(0,0x87);LCM_WriteString("Éß");
1001   2                break;
1002   2        case 2: LCM_WriteDatOrCom(0,0x87);LCM_WriteString("Âí");
1003   2                break;
1004   2        case 3: LCM_WriteDatOrCom(0,0x87);LCM_WriteString("Ñò");
1005   2                break;
1006   2        case 4: LCM_WriteDatOrCom(0,0x87);LCM_WriteString("ºï");
1007   2                break;
1008   2        case 5: LCM_WriteDatOrCom(0,0x87);LCM_WriteString("¼¦");
1009   2                break;
1010   2        case 6: LCM_WriteDatOrCom(0,0x87);LCM_WriteString("¹·");
1011   2                break;
1012   2        case 7: LCM_WriteDatOrCom(0,0x87);LCM_WriteString("Öí");
1013   2                break;
1014   2        case 8: LCM_WriteDatOrCom(0,0x87);LCM_WriteString("Êó");
1015   2                break;
1016   2        case 9: LCM_WriteDatOrCom(0,0x87);LCM_WriteString("Å£");
1017   2                break;
1018   2        case 10: LCM_WriteDatOrCom(0,0x87);LCM_WriteString("»¢");
1019   2                break;
1020   2        case 11: LCM_WriteDatOrCom(0,0x87);LCM_WriteString("ÍÃ");
1021   2                break;
1022   2       }
1023   1      
1024   1       
1025   1       
1026   1       
1027   1      }
1028          /********************************************************************************/
1029          void Keydone()
1030          {
1031   1      
1032   1              if (w == 0){   //Õı³£×ßÊ±
1033   2                      LCM_w_ss();//Ë¢ĞÂ Ãë
1034   2                      }
1035   1                      else {          //Æô¶¯µ÷Ê±
1036   2      
1037   2      
1038   2                      }
C51 COMPILER V7.08   WNL                                                                   04/09/2011 17:29:12 PAGE 18  

1039   1      
1040   1                      //------------------------------------------------------------------
1041   1                      if (KEY_3 == 0) // ÉèÖÃÊ±¼ä
1042   1              {
1043   2                      DelayM(20);        //È¥¶¶
1044   2      
1045   2                              if(KEY_3 == 0 && w == 1)  //µ±ÊÇµ÷Ê±×´Ì¬ ±¾¼üÓÃÓÚµ÷ÕûÏÂÒ»Ïî
1046   2                              {
1047   3                                      e++;
1048   3                                      if (e >= 6 ){e = 0;}
1049   3                                      Set_time(e);//µ÷Õû                              
1050   3                              }
1051   2                              
1052   2                              if(KEY_3 == 0 && w == 0)  //µ±ÊÇÕı³£×´Ì¬Ê±¾Í½øÈëµ÷Ê±×´Ì¬
1053   2                              {
1054   3                                      LCM_clr();//ÇåÆÁ
1055   3                                      //yy=0xff;mo=0xff;dd=0xff;xq=0xff;hh=0xff;mm=0xff;ss=0xff; //¸÷Êı¾İË¢ĞÂ
1056   3                                      w=1;      //½øÈëµ÷Ê±                            
1057   3                              /*      LCM_WriteDatOrCom(0,0x9e);
1058   3                                      LCM_WriteString(" [-]");
1059   3                                      LCM_WriteDatOrCom(0,0x80);
1060   3                                      LCM_WriteString("[Esc]");
1061   3                                      LCM_WriteDatOrCom(0,0x85);
1062   3                                      LCM_WriteString("[Next]");
1063   3                                      LCM_WriteDatOrCom(0,0x98);
1064   3                                      LCM_WriteString("[+]");*/
1065   3                                      Set_time(e);//µ÷Õû
1066   3                              }
1067   2                      while(KEY_3 == 0);//µÈ´ı¼üËÉ¿ª 
1068   2      
1069   2              }
1070   1      
1071   1                      //------------------------------------------------------------------
1072   1                      if (KEY_1 == 0) // µ±ÔÚµ÷Ê±×´Ì¬Ê±¾ÍÍË³öµ÷Ê±
1073   1              {
1074   2                      DelayM(20);
1075   2                      if(KEY_1 == 0 && w == 1){                               
1076   3                                      w = 0;    //ÍË³öµ÷Ê±
1077   3                                      e = 0;          //"ÏÂÒ»Ïî"¼ÆÊıÆ÷Çå0                                                             
1078   3                              }
1079   2      
1080   2                              if(KEY_1 == 0 && w == 0){                               
1081   3                                      LCM_clr();//ÇåÆÁ
1082   3                      chn_disp(tab1);//ÏÔÊ¾»¶Ó­×Ö
1083   3                                      //----------|-------1-------|-------3-------|-------2-------|-------4-------|-----//±ê³ß                                
1084   3                                      while(KEY_1 == 0);//µÈ´ı¼üËÉ¿ª  
1085   3                              }
1086   2                                      LCM_clr();//ÇåÆÁ
1087   2                                      //LCM_WriteString("[Dis]      [Set]");
1088   2                                      //yy=0xff;mo=0xff;dd=0xff;xq=0xff;hh=0xff;mm=0xff;ss=0xff; //¸÷Êı¾İË¢ĞÂ                         
1089   2                                      days();    //½ÚÈÕÏÔÊ¾
1090   2                                      updata ();      //Ë¢ĞÂÊı¾İ
1091   2                                      LCM_w_mm();//Ë¢ĞÂ ·Ö
1092   2                        nl();
1093   2                                      
1094   2      
1095   2                      while(KEY_1 == 0);//µÈ´ı¼üËÉ¿ª  
1096   2              }
1097   1      
1098   1                      //------------------------------------------------------------------
1099   1                      if (KEY_2 == 0 && w == 1){ // ¼Ó¼õµ÷Õû{
1100   2                      DelayM(20);
C51 COMPILER V7.08   WNL                                                                   04/09/2011 17:29:12 PAGE 19  

1101   2                      if(KEY_2 == 0 && w == 1){                               
1102   3                                      Set_time(e);//µ÷Õû
1103   3                              }
1104   2                      while(KEY_2 == 0);//µÈ´ı¼üËÉ¿ª
1105   2       
1106   2              }
1107   1      
1108   1                      //------------------------------------------------------------------
1109   1                      if (KEY_4 == 0 && w == 1){ // ¼Ó¼õµ÷Õû          
1110   2                      DelayM(20);
1111   2                      if(KEY_4 == 0 && w == 1){                               
1112   3                                      Set_time(e);//µ÷Õû
1113   3                              }
1114   2                      while(KEY_4 == 0);//µÈ´ı¼üËÉ¿ª
1115   2      
1116   2              }
1117   1      
1118   1                 //------------------------------------------------------------------
1119   1      }
1120          
1121          /*****************************************************************************/
1122          //---Ö÷³ÌĞò---//
1123          
1124          main() {
1125   1              
1126   1               e=0;
1127   1              KEY_1 = 1;KEY_2 = 1;KEY_3 = 1;KEY_4 = 1;//³õÊ¼¼üÅÌ
1128   1              yy=0xff;mo=0xff;dd=0xff;xq=0xff;hh=0xff;mm=0xff;ss=0xff; //¸÷Êı¾İË¢ĞÂ
1129   1                      beep = 0;
1130   1                      DelayM(900);
1131   1                      beep = 1;
1132   1              LCM_init();//³õÊ¼»¯Òº¾§ÏÔÊ¾Æ÷
1133   1              LCM_clr();//ÇåÆÁ
1134   1              chn_disp(tab1);//ÏÔÊ¾»¶Ó­×Ö
1135   1              DelayM(3000); //ÏÔÊ¾µÈÁô3Ãë
1136   1              LCM_clr();//ÇåÆÁ  
1137   1              Init_1302();
1138   1      
1139   1          while(1)
1140   1            {
1141   2              Keydone();
1142   2                              
1143   2             }
1144   1      }

C51 COMPILATION COMPLETE.  0 WARNING(S),  6 ERROR(S)
