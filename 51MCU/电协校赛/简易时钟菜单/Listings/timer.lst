C51 COMPILER V9.59.0.0   TIMER                                                             11/27/2025 23:10:50 PAGE 1   


C51 COMPILER V9.59.0.0, COMPILATION OF MODULE TIMER
OBJECT MODULE PLACED IN .\Objects\timer.obj
COMPILER INVOKED BY: D:\software\keil\C51\BIN\C51.EXE timer.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listin
                    -gs\timer.lst) TABS(2) OBJECT(.\Objects\timer.obj)

line level    source

   1          #include <globalvars.h>
   2          #include "timer.h"
   3          #include <intrins.h>
   4          #include <REGX52.H>
   5          // 定时器0初始化（1ms中断，硬件级精准计时）
   6          // 定时器0初始化（修复：统一1ms初值）
   7          void Timer0_Init() 
   8          {
   9   1          TMOD &= 0xF0;
  10   1          TMOD |= 0x01;  // 定时器0工作模式1（16位自动重装）
  11   1          // 11.0592MHz晶振，1ms中断初值计算：
  12   1          // 机器周期 = 12/11059200 = 1.085us
  13   1          // 1ms = 1000us，需计数次数 = 1000 / 1.085 ≈ 921
  14   1          // 初值 = 65536 - 921 = 64615 = 0xFC67
  15   1          TH0 = 0xFC;  // 高8位
  16   1          TL0 = 0x67;  // 低8位
  17   1          ET0 = 1;     // 允许定时器0中断
  18   1          EA = 1;      // 总中断允许
  19   1          TR0 = 1;     // 启动定时器0
  20   1      }
  21          
  22          // 定时器0中断服务函数（修复：重装载统一的1ms初值）
  23          void timer0_isr() interrupt 1 
  24          {
  25   1          // 重装载1ms初值（与初始化一致）
  26   1          TH0 = 0xFC;
  27   1          TL0 = 0x67;
  28   1          
  29   1          ms_cnt++;              // 毫秒计数+1（0-65535循环，足够使用）
  30   1          flag_1ms = 1;          // 1ms标志位
  31   1          
  32   1          if (ms_cnt % 1000 == 0) 
  33   1          {  // 每1000ms=1秒
  34   2              flag_1s = 1;           // 1秒标志位
  35   2          }
  36   1      }
  37          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =     89    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
