C51 COMPILER V9.59.0.0   SHOW                                                              11/27/2025 22:38:02 PAGE 1   


C51 COMPILER V9.59.0.0, COMPILATION OF MODULE SHOW
OBJECT MODULE PLACED IN .\Objects\show.obj
COMPILER INVOKED BY: D:\software\keil\C51\BIN\C51.EXE show.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listing
                    -s\show.lst) TABS(2) OBJECT(.\Objects\show.obj)

line level    source

   1          #include <globalvars.h>
   2          #include "show.h"
   3          #include "LCD1602.h"
   4          #include "delay.h"
   5          // 日历模式显示
   6          void show_calendar() 
   7          {
   8   1          LCD_ShowString(1, 1, "DATE:");
   9   1          LCD_ShowNum(1, 6, calendar[0], 4);
  10   1          LCD_ShowChar(1, 10, '-');
  11   1          LCD_ShowNum(1, 11, calendar[1], 2);
  12   1          LCD_ShowChar(1, 13, '-');
  13   1          LCD_ShowNum(1, 14, calendar[2], 2);
  14   1      
  15   1          LCD_ShowString(2, 1, "TIME:");
  16   1          LCD_ShowNum(2, 6, calendar[3], 2);
  17   1          LCD_ShowChar(2, 8, ':');
  18   1          LCD_ShowNum(2, 9, calendar[4], 2);
  19   1          LCD_ShowChar(2, 11, ':');
  20   1          LCD_ShowNum(2, 12, calendar[5], 2);
  21   1      
  22   1          if(set_flag) 
  23   1          {
  24   2              delay(100);
  25   2              switch(select_pos) 
  26   2              {
  27   3                  case 0: LCD_ShowString(1, 6, "    "); break;
  28   3                  case 1: LCD_ShowString(1, 11, "  "); break;
  29   3                  case 2: LCD_ShowString(1, 14, "  "); break;
  30   3                  case 3: LCD_ShowString(2, 6, "  "); break;
  31   3                  case 4: LCD_ShowString(2, 9, "  "); break;
  32   3                  case 5: LCD_ShowString(2, 12, "  "); break;
  33   3              }
  34   2              delay(100);
  35   2              switch(select_pos) 
  36   2              {
  37   3                  case 0: LCD_ShowNum(1, 6, calendar[0], 4); break;
  38   3                  case 1: LCD_ShowNum(1, 11, calendar[1], 2); break;
  39   3                  case 2: LCD_ShowNum(1, 14, calendar[2], 2); break;
  40   3                  case 3: LCD_ShowNum(2, 6, calendar[3], 2); break;
  41   3                  case 4: LCD_ShowNum(2, 9, calendar[4], 2); break;
  42   3                  case 5: LCD_ShowNum(2, 12, calendar[5], 2); break;
  43   3              }
  44   2              LCD_ShowChar(1, 10, '-');
  45   2              LCD_ShowChar(1, 13, '-');
  46   2              LCD_ShowChar(2, 8, ':');
  47   2              LCD_ShowChar(2, 11, ':');
  48   2          }
  49   1      }
  50          //***************************************************************************
  51          
  52          // 倒计时模式显示
  53          void show_countdown() 
  54          {
C51 COMPILER V9.59.0.0   SHOW                                                              11/27/2025 22:38:02 PAGE 2   

  55   1          LCD_ShowString(1, 1, "DOWN:");
  56   1          LCD_ShowNum(1, 5, countdown[0], 2);
  57   1          LCD_ShowChar(1, 7, ':');
  58   1          LCD_ShowNum(1, 8, countdown[1], 2);
  59   1          LCD_ShowChar(1, 10, ':');
  60   1          LCD_ShowNum(1, 11, countdown[2], 2);
  61   1      
  62   1          if (set_flag) 
  63   1          {
  64   2              LCD_ShowString(2, 1, "SET: K2=Q K1=S");
  65   2          } else 
  66   1          {
  67   2              LCD_ShowString(2, 1, countdown_running ? "RUN " : "STOP");
  68   2          }
  69   1      
  70   1          if(set_flag) 
  71   1          {
  72   2              delay(200);
  73   2              switch(select_pos) 
  74   2              {
  75   3                  case 0: LCD_ShowString(1, 5, "  "); break;
  76   3                  case 1: LCD_ShowString(1, 8, "  "); break;
  77   3                  case 2: LCD_ShowString(1, 11, "  "); break;
  78   3              }
  79   2              delay(200);
  80   2              switch(select_pos) 
  81   2              {
  82   3                  case 0: LCD_ShowNum(1, 5, countdown[0], 2); break;
  83   3                  case 1: LCD_ShowNum(1, 8, countdown[1], 2); break;
  84   3                  case 2: LCD_ShowNum(1, 11, countdown[2], 2); break;
  85   3              }
  86   2              LCD_ShowChar(1, 7, ':');
  87   2              LCD_ShowChar(1, 10, ':');
  88   2          }
  89   1      }
  90          //***************************************************************************
  91          
  92          // 秒表模式显示（1ms精度，视觉流畅）
  93          // 秒表模式显示（修复：首次进入强制显示零）
  94          void show_stopwatch() 
  95          {
  96   1          static unsigned char last_h, last_m, last_s, last_ms;
  97   1          static bit init_flag;
  98   1          unsigned char curr_ms = (stopwatch[3] / 10) % 100;  // 00-99 毫秒
  99   1      
 100   1          // 第一次进入函数时，强制显示初始零
 101   1          if (init_flag == 0) {
 102   2              last_h = 0xFF;  // 设为非零，确保后续判断为真
 103   2              last_m = 0xFF;
 104   2              last_s = 0xFF;
 105   2              last_ms = 0xFF;
 106   2              init_flag = 1;
 107   2      
 108   2              // 固定显示的字符（前缀、分隔符）
 109   2              LCD_ShowString(1, 1, "SW:");
 110   2              LCD_ShowChar(1, 6, ':');
 111   2              LCD_ShowChar(1, 9, ':');
 112   2              LCD_ShowChar(1, 12, '.');
 113   2              LCD_ShowString(2, 1, "        ");
 114   2      
 115   2              // 强制显示初始零（关键：首次进入直接写零）
 116   2              LCD_ShowNum(1, 4, 0, 2);  // 时：00
C51 COMPILER V9.59.0.0   SHOW                                                              11/27/2025 22:38:02 PAGE 3   

 117   2              LCD_ShowNum(1, 7, 0, 2);  // 分：00
 118   2              LCD_ShowNum(1, 10, 0, 2); // 秒：00
 119   2              LCD_ShowNum(1, 13, 0, 1); // 毫秒十位：0
 120   2              LCD_ShowNum(1, 14, 0, 1); // 毫秒个位：0
 121   2      
 122   2              // 更新缓存为零，避免重复显示
 123   2              last_h = 0;
 124   2              last_m = 0;
 125   2              last_s = 0;
 126   2              last_ms = 0;
 127   2              return;  // 首次显示完成，直接返回
 128   2          }
 129   1      
 130   1          // 后续仅更新变化的数值
 131   1          if (stopwatch[0] != last_h) {
 132   2              LCD_ShowNum(1, 4, stopwatch[0], 2);
 133   2              last_h = stopwatch[0];
 134   2          }
 135   1          if (stopwatch[1] != last_m) {
 136   2              LCD_ShowNum(1, 7, stopwatch[1], 2);
 137   2              last_m = stopwatch[1];
 138   2          }
 139   1          if (stopwatch[2] != last_s) {
 140   2              LCD_ShowNum(1, 10, stopwatch[2], 2);
 141   2              last_s = stopwatch[2];
 142   2          }
 143   1          if (curr_ms != last_ms) {
 144   2              LCD_ShowNum(1, 13, curr_ms / 10, 1);
 145   2              LCD_ShowNum(1, 14, curr_ms % 10, 1);
 146   2              last_ms = curr_ms;
 147   2          }
 148   1      }
 149          //***************************************************************************
 150          
 151          // 查看记录模式显示
 152          // 查看记录模式显示（修复2：简化显示逻辑，确保稳定可见）
 153          void show_records() 
 154          {
 155   1          LCD_WriteCommand(0x01);  // 清屏，避免残留内容干扰
 156   1          // 第一行：记录编号+总记录数（清晰提示当前状态）
 157   1          LCD_ShowString(1, 1, "REC:");
 158   1          LCD_ShowNum(1, 5, view_idx + 1, 1);  // 记录从1开始，符合用户习惯
 159   1          LCD_ShowChar(1, 6, '/');
 160   1          LCD_ShowNum(1, 7, record_cnt, 1);    // 显示已保存的记录数
 161   1      
 162   1          // 第二行：显示记录内容或无记录提示（修复拼写错误：NO DATA）
 163   1          if(record_cnt > 0) 
 164   1          {
 165   2              // 有记录时显示时分秒，格式对齐
 166   2              LCD_ShowNum(2, 4, records[view_idx][0], 2);
 167   2              LCD_ShowChar(2, 6, ':');
 168   2              LCD_ShowNum(2, 7, records[view_idx][1], 2);
 169   2              LCD_ShowChar(2, 9, ':');
 170   2              LCD_ShowNum(2, 10, records[view_idx][2], 2);
 171   2          } 
 172   1          else 
 173   1          {
 174   2              // 无记录时明确提示，避免用户误以为异常
 175   2              LCD_ShowString(2, 4, "NO DATA");
 176   2          }
 177   1      
 178   1          // 固定操作提示（不随记录变化，避免闪烁）
C51 COMPILER V9.59.0.0   SHOW                                                              11/27/2025 22:38:02 PAGE 4   

 179   1      //    if(record_cnt > 1) 
 180   1      //    {
 181   1      //        LCD_ShowString(1, 10, "K3U K4D");
 182   1      //    }
 183   1      //        LCD_ShowString(2, 12, "K1=B");
 184   1      
 185   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1104    ----
   CONSTANT SIZE    =     77    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      4       1
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      1    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
