C51 COMPILER V9.59.0.0   TIMECOUNT                                                         11/10/2025 23:22:03 PAGE 1   


C51 COMPILER V9.59.0.0, COMPILATION OF MODULE TIMECOUNT
OBJECT MODULE PLACED IN .\Objects\timecount.obj
COMPILER INVOKED BY: D:\software\keil\C51\BIN\C51.EXE timecount.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Li
                    -stings\timecount.lst) TABS(2) OBJECT(.\Objects\timecount.obj)

line level    source

   1          #include <REGX52.H>
   2          #include "timecount.h"
   3          
   4          unsigned char ledchar0[]={0xc0,0xf9,0xa4,0xb0,0x99,0x92,0x82,0xf8,0x80,0x90};//不带小数点
   5          unsigned char ledchar1[]={0x40,0x79,0x24,0x30,0x19,0x12,0x02,0x78,0x00,0x10};//带小数点
   6          unsigned char ledbuff[6]={0xFF,0xFF,0xFF,0xFF,0xFF};//led缓存数组
   7          int sec,min,hour,day,mon,year;
   8          unsigned int count=0;//进入中断的次数
   9          bit flag1s=0;
  10          
  11          //定时器设置**************************************************************/
  12          void Timer0_Init()//配置定时器
  13          { 
  14   1        
  15   1        TMOD &= 0xF0;   
  16   1        TMOD |= 0x01;     
  17   1        TF0 = 0;    
  18   1        TR0 = 1;      
  19   1        ET0=1;
  20   1        EA=1;
  21   1        PT0=0;
  22   1      }
  23          
  24          void Timer0_Routine() interrupt 1//定时器函数，每经过一秒定时器触发一次
  25          {
  26   1          static unsigned int T0Count;//定时器计数
  27   1          
  28   1          TL0=0x18;  
  29   1          TH0=0xfc;
  30   1          T0Count++;
  31   1          if(T0Count>=1000)  
  32   1          {
  33   2              T0Count=0;
  34   2              flag1s=1;
  35   2          }   
  36   1      }
  37          
  38          
  39          //计数设置**************************************************************/
  40          void timecount()
  41          {
  42   1        if(flag1s==1)
  43   1        {
  44   2          flag1s=0;
  45   2          sec++;
  46   2        }
  47   1        if(sec>=60)//秒计数
  48   1        {
  49   2          sec=0;
  50   2          min++;
  51   2        }
  52   1        
  53   1        if(min>=60)//分钟计数
  54   1        {
C51 COMPILER V9.59.0.0   TIMECOUNT                                                         11/10/2025 23:22:03 PAGE 2   

  55   2          min=0;
  56   2          hour++;
  57   2        }
  58   1        
  59   1        if(hour>=24)//小时计数
  60   1        {
  61   2          hour=0;
  62   2          day++;
  63   2        }
  64   1        
  65   1        if(mon==1||mon==3||mon==5||mon==7||mon==8||mon==10||mon==12)//月份计数，因日期数不同，进行条件判断
  66   1        {
  67   2            if(day>=32)
  68   2          {
  69   3            day=1;
  70   3            mon++;
  71   3          }
  72   2        }
  73   1        else
  74   1        {
  75   2          if(day>=31)
  76   2          {
  77   3            day=1;
  78   3            mon++;
  79   3          }
  80   2        }
  81   1        
  82   1        if(mon>=13)
  83   1          {
  84   2            mon=1;
  85   2            year++;
  86   2          }
  87   1          
  88   1        if(year>=2099)//年计数
  89   1          {
  90   2            year=2025;
  91   2          }   
  92   1      
  93   1      //更新显示缓存区的内容
  94   1      ledbuff[0] = year;    // 年
  95   1      ledbuff[1] = mon;     // 月
  96   1      ledbuff[2] = day;     // 日
  97   1      ledbuff[3] = hour;    // 时
  98   1      ledbuff[4] = min;     // 分
  99   1      ledbuff[5] = sec;     // 秒   
 100   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    325    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     42    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      1    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
